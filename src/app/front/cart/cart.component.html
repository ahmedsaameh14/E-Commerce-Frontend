<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="container mt-4 cart-container">
  <h3 class="mb-4 cart-title">ðŸ›’ Your Shopping Cart</h3>

  <div *ngIf="cartItems.length > 0; else emptyCart">
    <div *ngFor="let item of cartItems" class="card mb-3 shadow-sm cart-item">
      <div class="row g-0 align-items-center">
        <!-- Product Image -->
        <div class="col-md-2 col-4 text-center p-2">
          <img 
            [src]="'http://localhost:3000/uploads/' + item.productId?.imgURL" 
            alt="{{ item.productId?.name}}" 
            class="img-fluid rounded product-image">
        </div>

        <!-- Product Details -->
        <div class="col-md-10 col-8">
          <div class="card-body py-2">
            <div class="d-flex justify-content-between align-items-start">
              <h5 class="card-title mb-2 product-name">{{ item.productId?.name }}</h5>
              <button class="btn btn-sm btn-outline-danger remove-btn" (click)="removeItem(item._id)">
                <i class="fas fa-times"></i>
              </button>
            </div>
            
            <div class="d-flex flex-wrap align-items-center justify-content-between">
              <!-- Price -->
              <p class="card-text mb-2 me-3">
                <span class="text-muted">Price:</span> 
                <span class="fw-bold price">{{ item.currentPrice | currency:'EGP ' }}</span>
              </p>
              
              <!-- Quantity -->
              <div class="d-flex align-items-center mb-2 quantity-controls">
                <button class="btn btn-sm btn-outline-secondary" 
                        (click)="updateQuantity(item._id, item.quantity - 1)">
                  <i class="fas fa-minus"></i>
                </button>
                <input 
                  type="number" 
                  class="form-control form-control-sm quantity-input mx-1 text-center" 
                  [value]="item.quantity" 
                  min="1"
                  (change)="onQuantityChange($event, item._id)">
                <button class="btn btn-sm btn-outline-secondary" 
                        (click)="updateQuantity(item._id, item.quantity + 1)">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              
              <!-- Subtotal -->
              <p class="card-text mb-0">
                <span class="text-muted">Subtotal:</span> 
                <span class="fw-bold subtotal">{{ (item.currentPrice * item.quantity) | currency:'EGP ' }}</span>
              </p>
            </div>

            <!-- Price Change Notice -->
            <div *ngIf="item.priceChanged" class="alert alert-warning mt-2 mb-0 py-1 px-2 d-inline-flex align-items-center">
              <i class="fas fa-exclamation-circle me-2"></i>
              <span>Price has changed! Please confirm to proceed.</span>
              <button class="btn btn-sm btn-warning ms-2 confirm-btn" (click)="confirmPriceChange(item._id)">
                Confirm
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸ§® Total Price + Checkout -->
    <div class="total-section p-3 bg-light rounded shadow-sm mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Total:</h5>
        <h4 class="mb-0 total-price">{{ getTotal() | currency:'EGP ' }}</h4>
      </div>
      <div class="d-grid gap-2 mt-3">
        <button class="btn btn-lg btn-success checkout-btn" (click)="goToCheckout()">
          <i class="fas fa-credit-card me-2"></i> Proceed to Checkout
        </button>
        <button class="btn btn-outline-primary continue-btn" routerLink="/products">
          <i class="fas fa-arrow-left me-2"></i> Continue Shopping
        </button>
      </div>
    </div>
  </div>

  <!-- Empty Cart Template -->
  <ng-template #emptyCart>
    <div class="empty-cart text-center py-5">
      <div class="empty-icon mb-3">
        <i class="fas fa-shopping-cart fa-4x text-muted"></i>
      </div>
      <h4 class="mb-3">Your cart is empty</h4>
      <p class="text-muted mb-4">Looks like you haven't added any items to your cart yet.</p>
      <button class="btn btn-primary btn-lg" routerLink="/products">
        <i class="fas fa-store me-2"></i> Start Shopping
      </button>
    </div>
  </ng-template>
</div>
